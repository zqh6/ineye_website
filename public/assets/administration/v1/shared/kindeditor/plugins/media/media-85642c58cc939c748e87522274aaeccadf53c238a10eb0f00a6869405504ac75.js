KindEditor.plugin("media",function(e){var a=this,t="media",i=a.lang(t+"."),l=e.undef(a.allowMediaUpload,!0),n=e.undef(a.allowFileManager,!1),d=e.undef(a.formatUploadUrl,!0),o=e.undef(a.extraFileUploadParams,{}),r=e.undef(a.filePostName,"imgFile"),u=e.undef(a.uploadJson,a.basePath+"php/upload_json.php");a.plugin.media={edit:function(){var s=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+i.url+"</label>",'<input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+i.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+i.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:60px;">'+i.width+"</label>",'<input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="550" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keHeight" style="width:60px;">'+i.height+"</label>",'<input type="text" id="keHeight" class="ke-input-text ke-input-number" name="height" value="400" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keAutostart">'+i.autostart+"</label>",'<input type="checkbox" id="keAutostart" name="autostart" value="" /> ',"</div>","</div>"].join(""),c=a.createDialog({name:t,width:450,height:230,title:a.lang(t),body:s,yesBtn:{name:a.lang("yes"),click:function(){var t=e.trim(g.val()),i=h.val(),l=v.val();if("//"==t||e.invalidUrl(t))return alert(a.lang("invalidUrl")),void g[0].focus();if(!/^\d*$/.test(i))return alert(a.lang("invalidWidth")),void h[0].focus();if(!/^\d*$/.test(l))return alert(a.lang("invalidHeight")),void v[0].focus();var n=e.mediaImg(a.themesPath+"common/blank.gif",{src:t,type:e.mediaType(t),width:i,height:l,autostart:f[0].checked?"true":"false",loop:"true"});a.insertHtml(n).hideDialog().focus()}}}),p=c.div,g=e('[name="url"]',p),m=e('[name="viewServer"]',p),h=e('[name="width"]',p),v=e('[name="height"]',p),f=e('[name="autostart"]',p);if(g.val("//"),l){var k=e.uploadbutton({button:e(".ke-upload-button",p)[0],fieldName:r,extraParams:o,url:e.addParam(u,"dir=media"),afterUpload:function(i){if(c.hideLoading(),0===i.error){var l=i.url;d&&(l=e.formatUrl(l,"absolute")),g.val(l),a.afterUpload&&a.afterUpload.call(a,l,i,t),alert(a.lang("uploadSuccess"))}else alert(i.message)},afterError:function(e){c.hideLoading(),a.errorDialog(e)}});k.fileBox.change(function(){c.showLoading(a.lang("uploadLoading")),k.submit()})}else e(".ke-upload-button",p).hide();n?m.click(function(){a.loadPlugin("filemanager",function(){a.plugin.filemanagerDialog({viewType:"LIST",dirName:"media",clickFn:function(t){a.dialogs.length>1&&(e('[name="url"]',p).val(t),a.afterSelectFile&&a.afterSelectFile.call(a,t),a.hideDialog())}})})}):m.hide();var b=a.plugin.getSelectedMedia();if(b){var w=e.mediaAttrs(b.attr("data-ke-tag"));g.val(w.src),h.val(e.removeUnit(b.css("width"))||w.width||0),v.val(e.removeUnit(b.css("height"))||w.height||0),f[0].checked="true"===w.autostart}g[0].focus(),g[0].select()},"delete":function(){a.plugin.getSelectedMedia().remove(),a.addBookmark()}},a.clickToolbar(t,a.plugin.media.edit)});